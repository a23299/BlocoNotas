@model BlocoNotas.Models.ApplicationUser

@{
    ViewData["Title"] = "Eliminar Utilizador";
}

<div class="container mt-4">
    <h2>Eliminar Utilizador</h2>

    <div id="alertArea"></div>

    <div class="alert alert-warning mt-4">
        <strong>Tem a certeza que deseja eliminar este utilizador?</strong><br />
        Esta ação não pode ser desfeita.
    </div>

    <dl class="row">
        <dt class="col-sm-2">ID</dt>
        <dd class="col-sm-10" id="UserId">@Model.Id</dd>

        <dt class="col-sm-2">Nome</dt>
        <dd class="col-sm-10" id="UserName">@Model.UserName</dd>

        <dt class="col-sm-2">Email</dt>
        <dd class="col-sm-10" id="Email">@Model.Email</dd>
    </dl>

    <form id="deleteForm">
        <input type="hidden" id="HiddenUserId" value="@Model.Id" />
        <button type="submit" class="btn btn-danger">Eliminar</button>
        <a href="/Users/Index" class="btn btn-secondary">Cancelar</a>
    </form>
</div>

<script>
document.getElementById("deleteForm").addEventListener("submit", async e => {
    e.preventDefault();

    const userId = document.getElementById("HiddenUserId").value;
    const token = localStorage.getItem("token");

    try {
        const res = await fetch(`/api/UsersApi/${userId}`, {
            method: "DELETE",
            headers: {
                "Authorization": `Bearer ${token}`
            }
        });

        if (res.ok) {
            showAlert("success", "Utilizador eliminado com sucesso.");
            setTimeout(() => {
                window.location.href = "/Users/Index";
            }, 1500);
        } else {
            const errText = await res.text();
            showAlert("danger", "Erro ao eliminar: " + errText);
        }
    } catch (err) {
        showAlert("danger", "Erro: " + err.message);
    }
});

function showAlert(type, message) {
    const alertArea = document.getElementById("alertArea");
    alertArea.innerHTML = `
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
        </div>
    `;
}
</script>
